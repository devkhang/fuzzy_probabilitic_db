name: .NET Framework CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: windows-2019

    steps:
    - uses: actions/checkout@v4

    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v2

    - name: Setup NuGet
      uses: NuGet/setup-nuget@v2

    - name: Setup VSTest
      uses: darenm/Setup-VSTest@v1

    # SỬA LỖI 1: Đường dẫn file .sln
    # Hãy đảm bảo cấu trúc thư mục trên GitHub của bạn đúng là FPRDB/FPRDB.sln
    # Nếu file .sln nằm ngay ngoài cùng, hãy xóa đoạn "FPRDB/" đi, chỉ để lại "FPRDB.sln"
    - name: Restore dependencies
      run: nuget restore FPRDB/FPRDB.sln

    # SỬA LỖI 2: Thêm cấu hình Release
    # Mặc định MSBuild sẽ build ra Debug, nhưng bên dưới bạn lại test thư mục Release
    # -> Phải ép nó build ra Release bằng lệnh /p:Configuration=Release
    - name: Build
      run: msbuild FPRDB/FPRDB.sln /p:Configuration=Release

    # SỬA LỖI 3: Chạy Test
    # Do đã build Release ở trên, nên file DLL sẽ nằm trong bin\Release
    - name: Test
      run: vstest.console.exe UnitTestProject1\bin\Release\UnitTestProject1.dll